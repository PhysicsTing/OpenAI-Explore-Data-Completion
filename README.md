# OpenAI-Explore-Data-Completion

This is a simple exploring project to make use of OpenAI LLM API to process and complete previously incomplete Json data.

## Use case scenario

John wants to build an credit card manage application. This application must maintain a list of basic credit card information that looks like:

```
{
    "3470": {
        "name": [
            "RBC Cash Back Mastercard"
        ],
        "bankInfo": {
            "bank": "",
            "brand": "",
            "type": "",
            "bankURL": "",
            "picURL": ""
        },
        "benefits": {
            "description": "Get up to 2% cash back on grocery store purchases, and up to 1% cash back on all other qualifying purchases and pre-authorized payments.",
            "grocery": 2.0,
            "regular": 1.0
        }
    },
    
    "3876": {
        ...
    },
    
    ...
}
```
John already got the name and description information via a web crawler. The problem is that he still need to fill in the rest of the information, such as bank name, the branch of the card etc, but he's tired of writting the crawler. Since the necessary information are alreay there in the description, potentially a LLM such as the ones provided by OpenAI could help.

## Approach

1. There will be dozens of cards in the list, or millions of entries in other use case scenrio, which definitly exceeds OpenAI API's max token limition. So we will need a script to first break the Json data into small trucks, and feed into the API one entry after another.
2. Apparently a prompt is required to instruct the LLM about how to process this data.
3. Apon receiving the response, parse the returned string back into Json. Concat all response togather, and generate the updated file.
4. Since the project is using OpenAI anyway, and John is too lazy to even write the script to parse the Json file, might as well ask OpenAI to write the script directly.

## Files

#### process.py
This file is originally generated by chatGPT withfollowing promot:
> I have a json file called metadata.json. It contains a list of credit card information. Example of this json:
>
> ```< Give two examples of entries from the Json file here >```
>
> As you can see, many fields in bankInfo are empty. I want to ask open AI to complete these fields based on the description strings, however my files are very long and cannot be passed into openAI api as a whole file. Therefore, I want you to write me a wrapper script, that uses the openAI API. This script will:
>
> 1. Read this metadata.json file
> 2. Break this json file into mutiple pieces. Apparently each individual card will be its own piece.
> 3. Call openAI api, and pass in each piece one at a time
> 4. For each API call, ask openAI api to fill in the bankInfo section based on the description. The bankURL and picURL and be empty. The brand will be either amex card, or master card, or visa. the type is based on what kind of reward it provideds, for exaple cashback, or reword point.
> 5. Collect the returned otput, and concat them into a new json file
>
> The new json file should be almost the same as the original one, except more fields are filled in.

A few modification was done after the first generation. Mainly the prompt string are modified to be more specific, and the step of parsing the returned string into Json object are easily broken because the response from API are not always a strict Json format.

#### metadata.json

The original incomplete data which contains information about 50+ credit card used in Canada.

#### updated_metadata.json

Newly generated json with empty fields filled in by OpenAI LLM via process.py 

## Conclusion

Model davinci has the capacity to complete the task surprisingly well.
Model curie is less smart, and may need a lot effort in prompting.
Model ada on the other hand does not have the capability at all to understand concept such as json, or complex instructions.

## Test Results

- Even thought for each entry, the prompt specifically asks to return the result with json properties in double quotation, the model still have certain chances of using single quotation, which causes json parsing to fail.
- Sometime the bankUrl filled in by model is too long, and causes the json parsing to fail.

Below are some test results with different models:

### text-davinci-002 (Most capable)

text-davinci-002 temperature=0
```
============================
success:       55
fail:          0
time elapsed:  214.5859341621399
============================
```

text-davinci-002 temperature=0.5
```
============================
success:       52
fail:          3
time elapsed:  280.3291530609131
============================
```

text-davinci-002 temperature=1
```
============================
success:       50
fail:          5
time elapsed:  215.16787004470825
============================
```

### text-ada-001 (Fast and cheap)

This is expected, that it appears that text-ada-001 has very little ability to understand complex instruction, and the results are not even close to the task goal.

text-ada-001 temperature=0
```
============================
success:       0
fail:          55
time elapsed:  94.99054312705994
============================
```
Example output:
```
The bankinfo section in the definition of National Bank Syncro Mastercard has the following content:

The bank is National Bank Syncro Mastercard.
```

### text-curie-001 (Less capable than davinci)

curie model returns better json format than ada, however it has trouble when taking mutiple instructions at the same time. It does not add curly brackets at the begining. When ptompting specifically to do so, it does not use double quotation. Furthermore it does not understand very well the task, and returned json structures that is relevent but not exactly the goal. Perhaps with some tuning in prompt, it can still complete the task, except now as smooth as davinci.

text-curie-001 temperature=0
```
============================
success:       1
fail:          54
time elapsed:  127.9404878616333
============================
```

Example output:
```
{'name': 'American Express AIR MILES Reserve Credit Card', 'bankInfo': {'bank': '', 'brand': '', 'type': '', 'bankURL': '', 'picURL': ''}, 'benefits': {'description': 'Earn 1 AIR MILE for every $10 spent on purchases at eligible stand-alone grocery stores, gas stations and drugs stores in Canada, as well as eligible AIR MILES partners, and earn 1 AIR MILE for every $15 spent on all other eligible purchases elsewhere.', 'AirMilePartners': 0.1, 'Grocery': 0.1, 'gas': 0.1, 'pharamercy': 0.1, 'regular': 0.06, 'redeemFactorMin': 5.0, 'redeemFactorMax': 10.0}, 'bankInfo': {'bank': '', 'brand': '', 'type': '', 'bankURL': '', 'picURL': ''}, 'picURL': 'https://www.americanexpress.com/ca/images/products/air-miles/reserve-credit-card/american-express-air-miles-reserve-credit-card.jpg'}
```
